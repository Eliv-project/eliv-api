//******** AUTO GENERATED FILE, DO NOT EDIT.  *********

// Base prisma file, use prisma-merge (https://www.npmjs.com/package/prisma-merge) 
// to find *.schema.prisma files  automatically in directory and generate final schema.prisma file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URL")
}

generator nestgraphql {
    provider = "node node_modules/prisma-nestjs-graphql"
    // for yarn monorepos
    // provider = "prisma-nestjs-graphql"
    output = "./@generated"
}

model Comment {
    id      Int    @unique @default(autoincrement())
    content String

    createdAt DateTime @default(now())
    updatedAt DateTime @default(now())

    user    User  @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId  Int 
    video   Video @relation(fields: [videoId], references: [id], onDelete: Cascade)
    videoId Int  

    parentComment   Comment? @relation("childComments", fields: [parentCommentId], references: [id], onDelete: Cascade)
    parentCommentId Int?

    childComments Comment[] @relation("childComments")
    votes         Vote[]
}


model LiveSession {
    id Int @id @default(autoincrement())

    status Int @default(0)
    streamKey String @unique @default(uuid())

    createdAt DateTime @default(now())
    updatedAt DateTime @default(now())

    video Video @relation(fields: [videoId], references: [id], onDelete: Cascade)
    videoId Int @unique
}

model OAuthLink {
    provider String
    providerId String @unique

    user User @relation(fields: [userId], references: [id])
    userId Int

    @@id([provider, providerId])
}

model PermissionsOnRoles {
    role         Role       @relation(fields: [roleId], references: [id])
    roleId       Int // relation scalar field (used in the `@relation` attribute above)
    permission   Permission @relation(fields: [permissionId], references: [id])
    permissionId Int // relation scalar field (used in the `@relation` attribute above)
    createdAt    DateTime   @default(now())

    @@id([roleId, permissionId])
}


model Permission {
    id Int @unique @id @default(autoincrement())
    name String @unique

    roles PermissionsOnRoles[]
    
}

model Role {
    id   Int    @id @unique @default(autoincrement())
    name String @unique

    permissions PermissionsOnRoles[]
    users       User[]
}


model UserSubscription {
    user              User     @relation("subscribedBy", fields: [userId], references: [id])
    userId            Int
    subscribingUser   User     @relation("subscribing", fields: [subscribingUserId], references: [id])
    subscribingUserId Int // relation scalar field (used in the `@relation` attribute above)
    createdAt         DateTime @default(now())

    @@id([userId, subscribingUserId])
}


model User {
    id       Int      @id @default(autoincrement())
    email    String   @unique
    username String   @unique
    gender   Boolean? @default(true)

    /// @HideField({output: true, input: true})
    password String

    avatar    Json?
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now())

    role   Role @relation(fields: [roleId], references: [id])
    roleId Int

    subscribingUsers UserSubscription[] @relation("subscribing")
    subscribers      UserSubscription[] @relation("subscribedBy")

    oauthLinks OAuthLink[]
    videos     Video[]
    comments   Comment[]
    votes      Vote[]
}


model Video {
    id Int @id @default(autoincrement())

    name String
    desc String?

    /// @HideField({input: true, output: true})
    searchableName String?

    thumbnail Json?

    slug String? @unique

    privacy Int? @default(0) 

    createdAt DateTime @default(now())
    updatedAt DateTime @default(now())

    /// @HideField({input: true, output: false})
    dirId String? @unique

    user User @relation(fields: [userId], references: [id])
    userId Int

    liveSession LiveSession?
    vodSession VodSession?
    comments Comment[]
    votes Vote[]
}

model VodSession {
    id Int @id @default(autoincrement())

    status Int @default(0)

    createdAt DateTime @default(now())
    updatedAt DateTime @default(now())

    video Video @relation(fields: [videoId], references: [id], onDelete: Cascade)
    videoId Int @unique
}

model Vote {
    id            Int @id @default(autoincrement())
    voteDirection Int

    createdAt DateTime @default(now())
    updatedAt DateTime @default(now())

    user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId    Int
    comment   Comment? @relation(fields: [commentId], references: [id], onDelete: Cascade)
    commentId Int?
    video     Video?   @relation(fields: [videoId], references: [id], onDelete: Cascade)
    videoId   Int?
}
